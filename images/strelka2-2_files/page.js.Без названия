!function(){"use strict";const t=new Promise((t=>{function e(){"loading"!=document.readyState&&t()}document.addEventListener("readystatechange",e),e()})),e=document.createRange();function s(t){return e.createContextualFragment(t).children[0]}e.selectNode(document.documentElement);const i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function n(t,...e){return e=e.map((t=>String(t).replace(/[&<>"'/]/g,(t=>i[t])))),t.reduce(((t,s,i)=>t+(s+(e[i]||""))),"")}function o(t){return new Response(t).text()}function r({removeClass:t=!1}={}){return function(e,s="active",i="transition"){if(t){if(!e.classList.contains(s))return Promise.resolve()}else if(e.classList.contains(s))return Promise.resolve();const n=new Promise((n=>{const o=t=>{t.target==e&&(e.removeEventListener("transitionend",o),e.classList.remove(i),n())};e.classList.add(i),requestAnimationFrame((()=>{e.addEventListener("transitionend",o),e.classList[t?"remove":"add"](s)}))})),o=new Promise((t=>setTimeout(t,1e3)));return Promise.race([n,o])}}const a=r(),c=r({removeClass:!0});let h=(()=>{let t;function e(){return t||(t=new Promise(((t,e)=>{const s=indexedDB.open("svgo-keyval",1);s.onerror=()=>{e(s.error)},s.onupgradeneeded=()=>{s.result.createObjectStore("keyval")},s.onsuccess=()=>{t(s.result)}}))),t}async function s(t,s){const i=await e();return new Promise(((e,n)=>{const o=i.transaction("keyval",t);o.oncomplete=()=>e(),o.onerror=()=>n(o.error),s(o.objectStore("keyval"))}))}return{async get(t){let e;return await s("readonly",(s=>{e=s.get(t)})),e.result},set:(t,e)=>s("readwrite",(s=>{s.put(e,t)})),delete:t=>s("readwrite",(e=>{e.delete(t)}))}})();self.indexedDB||(h={get:t=>Promise.resolve(localStorage.getItem(t)),set:(t,e)=>Promise.resolve(localStorage.setItem(t,e)),delete:t=>Promise.resolve(localStorage.removeItem(t))});class l{constructor(t){this._requestId=0,this._pending={},this._url=t,this._worker=null}release(){this._abortPending(),this._worker&&(this._worker.terminate(),this._worker=null)}abort(){0!==Object.keys(this._pending).length&&(this._abortPending(),this._worker&&this._worker.terminate(),this._startWorker())}_abortPending(){for(const t of Object.keys(this._pending))this._fulfillPending(t,null,new DOMException("AbortError","AbortError"))}_startWorker(){this._worker=new Worker(this._url),this._worker.onmessage=t=>this._onMessage(t)}_postMessage(t){this._worker||this._startWorker(),this._worker.postMessage(t)}_onMessage(t){t.data.id?this._fulfillPending(t.data.id,t.data.result,t.data.error&&new Error(t.data.error)):console.log("Unexpected message",t)}_fulfillPending(t,e,s){const i=this._pending[t];i?(delete this._pending[t],s?i[1](s):i[0](e)):console.log("No resolver for",{id:t,result:e,error:s})}_requestResponse(t){return new Promise(((e,s)=>{t.id=++this._requestId,this._pending[t.id]=[e,s],this._postMessage(t)}))}}const d=new class extends l{constructor(){super("js/gzip-worker.js")}compress(t){return this._requestResponse({data:t})}};class u{constructor(t,e,s){this.text=t,this._compressedSize=null,this._url=null,this.width=e,this.height=s}async size({compress:t}){return t?(this._compressedSize||(this._compressedSize=d.compress(this.text).then((t=>t.byteLength))),this._compressedSize):this.text.length}get url(){return this._url||(this._url=URL.createObjectURL(new Blob([this.text],{type:"image/svg+xml"}))),this._url}release(){this._url&&URL.revokeObjectURL(this._url)}}function _(t){return{x:t.pageX,y:t.pageY}}function p(t,e){const s=Math.abs(e.x-t.x),i=Math.abs(e.y-t.y);return Math.sqrt(s*s+i*i)}function m(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}}function v(t){return t.touches?Array.from(t.touches).map((t=>_(t))):[_(t)]}class g{constructor(t,{eventArea:e=t,shouldCaptureFunc:s=(()=>!0)}={}){this._target=t,this._shouldCaptureFunc=s,this._dx=0,this._dy=0,this._scale=1,this._active=0,this._lastPoints=[],["_onPointerDown","_onPointerMove","_onPointerUp"].forEach((t=>{this[t]=this[t].bind(this)})),e.addEventListener("mousedown",this._onPointerDown),e.addEventListener("touchstart",this._onPointerDown),e.addEventListener("wheel",(t=>this._onWheel(t)))}reset(){this._dx=0,this._dy=0,this._scale=1,this._update()}_onWheel(t){if(!this._shouldCaptureFunc(t.target))return;t.preventDefault();const e=this._target.getBoundingClientRect();let s=t.deltaY;1===t.deltaMode&&(s*=15),s=Math.max(Math.min(s,60),-60);const i=s/300+1;this._scale*i<.05||(this._scale*=i,this._dx-=(t.pageX-e.left)*(i-1),this._dy-=(t.pageY-e.top)*(i-1),this._update())}_onFirstPointerDown(){document.addEventListener("mousemove",this._onPointerMove),document.addEventListener("mouseup",this._onPointerUp),document.addEventListener("touchmove",this._onPointerMove),document.addEventListener("touchend",this._onPointerUp)}_onPointerDown(t){"mousedown"==t.type&&0!==t.button||this._shouldCaptureFunc(t.target)&&(t.preventDefault(),this._lastPoints=v(t),this._active++,1===this._active&&this._onFirstPointerDown())}_onPointerMove(t){t.preventDefault();const e=v(t),s=e.reduce(m),i=this._lastPoints.reduce(m),n=this._target.getBoundingClientRect();if(this._dx+=s.x-i.x,this._dy+=s.y-i.y,e[1]){const t=p(e[0],e[1])/p(this._lastPoints[0],this._lastPoints[1]);this._scale*=t,this._dx-=(s.x-n.left)*(t-1),this._dy-=(s.y-n.top)*(t-1)}this._update(),this._lastPoints=e}_update(){this._target.style.transform=`translate3d(${this._dx}px, ${this._dy}px, 0) scale(${this._scale})`}_onPointerUp(t){t.preventDefault(),this._active--,this._lastPoints.pop(),this._active?this._lastPoints=v(t):(document.removeEventListener("mousemove",this._onPointerMove),document.removeEventListener("mouseup",this._onPointerUp),document.removeEventListener("touchmove",this._onPointerMove),document.removeEventListener("touchend",this._onPointerUp))}}class w{constructor(){this.container=s('<div class="svg-output"><div class="svg-container"><iframe class="svg-frame" sandbox="allow-scripts"></iframe></div><div class="svg-clickjacker"></div></div>'),this._svgFrame=this.container.querySelector(".svg-frame"),this._svgFrame.scrolling="no",this._svgContainer=this.container.querySelector(".svg-container"),t.then((()=>{this._panZoom=new g(this._svgContainer,{eventArea:this.container})}))}setSvg(t){const e=this._nextLoadPromise();return this._svgFrame.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(t.text),this._svgFrame.width=t.width,this._svgFrame.height=t.height,e}reset(){this._svgFrame.src="about:blank",this._panZoom.reset()}_nextLoadPromise(){return new Promise((t=>{const e=()=>{this._svgFrame.removeEventListener("load",e),t()};this._svgFrame.addEventListener("load",e)}))}}const y=new class extends l{constructor(){super("js/prism-worker.js")}highlight(t){return this._requestResponse({data:t})}};class f{constructor(){this.container=s('<div class="code-output"><pre><code></code></pre></div>'),this._codeEl=this.container.querySelector("code")}async setSvg(t){this._codeEl.innerHTML=await y.highlight(t.text)}reset(){this._codeEl.innerHTML=""}}class L{constructor(){this.container=s('<div class="output-switcher"></div>'),this._types={image:new w,code:new f},this._svgFile=null,this._switchQueue=Promise.resolve(),this.set("image",{noAnimate:!0})}update(t){return this._svgFile=t,this._types[this._activeType].setSvg(t)}reset(){this._types[this._activeType].reset()}set(t,{noAnimate:e=!1}={}){return this._switchQueue=this._switchQueue.then((async()=>{const s=this._activeType&&this._types[this._activeType].container;this._activeType=t;const i=this._types[this._activeType].container;if(this.container.appendChild(i),this._svgFile&&await this.update(this._svgFile),e)i.classList.add("active"),s&&s.classList.remove("active");else{const t=[a(i)];s&&t.push(c(s)),await Promise.all(t)}s&&this.container.removeChild(s)}))}}class C{constructor(){this.container=s('<div class="ripple"></div>')}animate(){this.container.classList.remove("animate"),this.container.offsetLeft,this.container.classList.add("animate")}}class E{constructor(){this.container=s('<div class="spinner"><div class="spinner-container"><div class="spinner-layer"><div class="circle-clipper left"><div class="circle"></div></div><div class="gap-patch"><div class="circle"></div></div><div class="circle-clipper right"><div class="circle"></div></div></div></div></div>'),this._showTimeout=null,this.container.style.display="none";this.container.addEventListener("animationend",(t=>{t.target==this.container&&(this.container.style.display="none")}))}show(t=300){clearTimeout(this._showTimeout),this.container.style.display="none",this.container.classList.remove("cooldown"),this._showTimeout=setTimeout((()=>{this.container.style.display=""}),t)}hide(){clearTimeout(this._showTimeout),this.container.classList.add("cooldown")}}class k{constructor({title:t,href:e,iconSvg:i,classList:n,minor:o}){this.container=s((e?"<a>":'<div role="button" tabindex="0">')+i+(e?"</a>":"</div>")),e&&(this.container.href=e),t&&this.container.setAttribute("title",t),this.container.classList.add(o?"minor-floating-action-button":"floating-action-button"),n&&n.forEach((t=>{this.container.classList.add(t)})),this._ripple=new C,this.container.appendChild(this._ripple.container),this._spinner=new E,this.container.appendChild(this._spinner.container),this.container.addEventListener("click",(()=>this._onClick()))}_onClick(){this._ripple.animate()}working(){this._spinner.show(500)}done(){this._spinner.hide()}}class b extends k{constructor(){const t="Download";super({title:t,href:"./",iconSvg:'<svg class="icon" viewBox="0 0 24 24"><title>Download</title><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>'})}_onClick(t){super._onClick(t)}setDownload(t,e){this.container.download=t,this.container.href=e.url}}class S extends k{constructor(){const t="Copy as text";super({title:t,iconSvg:`<svg class="icon" viewBox="0 0 24 24"><title>${t}</title><path d="M16 1H4C3 1 2 2 2 3v14h2V3h12V1zm3 4H8C7 5 6 6 6 7v14c0 1 1 2 2 2h11c1 0 2-1 2-2V7c0-1-1-2-2-2zm0 16H8V7h11v14z"/></svg>`,minor:!0}),this._text=null,this._pre=document.createElement("pre")}_onClick(t){super._onClick(t),this.copyText()}copyText(){if(!this._text)return!1;this._pre.textContent=this._text,document.body.appendChild(this._pre),getSelection().removeAllRanges();const t=document.createRange();return t.selectNode(this._pre),window.getSelection().addRange(t),document.execCommand("copy"),getSelection().removeAllRanges(),document.body.removeChild(this._pre),!0}setCopyText(t){this._text=t}}class x extends k{constructor(){const t="Preview on vivid background";super({title:t,iconSvg:`<svg class="icon" viewBox="0 0 24 24"><title>${t}</title><path d="M21.143 9.667c-.733-1.392-1.914-3.05-3.617-4.753C14.549 1.936 12.048 1 10.741 1c-.414 0-.708.094-.86.246L8.52 2.606c-1.899-.236-3.42.106-4.294.983-.876.875-1.164 2.159-.792 3.523.492 1.806 2.305 4.049 5.905 5.375.038.323.157.638.405.885.588.588 1.535.586 2.121 0s.588-1.533.002-2.119a1.5 1.5 0 0 0-2.123-.001l-.17.256c-2.031-.765-3.395-1.828-4.232-2.9l3.879-3.875c.496 2.73 6.432 8.676 9.178 9.178l-7.115 7.107c-.234.153-2.798-.316-6.156-3.675-3.393-3.393-3.175-5.271-3.027-5.498L3.96 9.989C3.521 9.63 3.035 8.886 2.819 8.3L.685 10.431C.24 10.877 0 11.495 0 12.251c0 1.634 1.121 3.915 3.713 6.506C6.477 21.521 9.293 23 11.145 23c.648 0 1.18-.195 1.547-.562l8.086-8.078c.91.874-.778 3.538-.778 4.648a2 2 0 0 0 4-.001c0-3.184-1.425-6.81-2.857-9.34zM4.934 4.296c.527-.53 1.471-.791 2.656-.761L4.381 6.741c-.236-.978-.049-1.845.553-2.445zm9.292 4.079-.03-.029C12.904 7.054 10.393 3.99 11.1 3.283c.715-.715 3.488 1.521 5.062 3.096.862.862 2.088 2.247 2.937 3.458-1.717-1.074-3.491-1.469-4.873-1.462z"/></svg>`,minor:!0})}_onClick(t){super._onClick(t),this.container.classList.contains("active")?(this.container.classList.remove("active"),this.setColor("transparent")):(this.container.classList.add("active"),this.setColor("rgba(0, 0, 0, 0.7)"))}setColor(t){document.documentElement.style.backgroundColor=t}}function U(t,e){const s=Math.pow(10,e);return Math.floor(Math.round(t*s))/s}function P(t){return t<1024?t+" bytes":U(t/1024,2)+"k"}class F{constructor(){this.container=s('<div class="results"><span class="size"></span> <span class="diff"></span></div>'),this._sizeEl=this.container.querySelector(".size"),this._diffEl=this.container.querySelector(".diff")}update({size:t,comparisonSize:e}){this._sizeEl.textContent=e?P(e)+" → "+P(t):P(t),this._diffEl.classList.remove("decrease","increase"),e?t===e?this._diffEl.textContent="100%":(this._diffEl.textContent=U(t/e*100,2)+"%",this._diffEl.classList.add(t>e?"increase":"decrease")):this._diffEl.textContent=""}}let D=()=>({events:{},emit(t,...e){(this.events[t]||[]).forEach((t=>t(...e)))},on(t,e){return(this.events[t]=this.events[t]||[]).push(e),()=>this.events[t]=(this.events[t]||[]).filter((t=>t!==e))}});class M{constructor(t){this.container=s('<div class="material-slider"><div class="track"><div class="track-on"></div><div class="handle"><div class="arrow"></div><div class="val"></div></div></div></div>'),this.range=t,this._handle=this.container.querySelector(".handle"),this._trackOn=this.container.querySelector(".track-on"),this._val=this.container.querySelector(".val"),t.parentNode.insertBefore(this.container,t),this.container.insertBefore(t,this.container.firstChild),t.addEventListener("input",(()=>this._onInputChange())),this.range.addEventListener("mousedown",(()=>this._onRangeMouseDown())),this.range.addEventListener("touchstart",(()=>this._onRangeTouchStart())),this.range.addEventListener("touchend",(()=>this._onRangeTouchEnd())),this._setPosition()}_onRangeTouchStart(){this.range.focus()}_onRangeTouchEnd(){this.range.blur()}_onRangeMouseDown(){this.range.classList.add("active");const t=()=>{requestAnimationFrame((()=>{this.range.blur()})),this.range.classList.remove("active"),document.removeEventListener("mouseup",t)};document.addEventListener("mouseup",t)}set value(t){this.range.value=t,this._update()}_onInputChange(){this._update()}_update(){requestAnimationFrame((()=>this._setPosition()))}_setPosition(){const{min:t,max:e,value:s}=this.range,i=(Number(s)-t)/(e-t);this._trackOn.style.width=this._handle.style.left=100*i+"%",this._val.textContent=s}}class q{constructor(){this.emitter=D(),this._throttleTimeout=null,t.then((()=>{this._pluginInputs=Array.from(document.querySelectorAll(".settings .plugins input")),this._globalInputs=Array.from(document.querySelectorAll(".settings .global input")),this._resetRipple=new C,this._resetBtn=document.querySelector(".setting-reset"),this._resetBtn.appendChild(this._resetRipple.container),this._sliderMap=new WeakMap,Array.from(document.querySelectorAll(".settings input[type=range]")).forEach((t=>this._sliderMap.set(t,new M(t)))),this.container=document.querySelector(".settings"),this._scroller=document.querySelector(".settings-scroller"),this.container.addEventListener("input",(t=>this._onChange(t))),this._scroller.addEventListener("wheel",(t=>this._onMouseWheel(t))),this._resetBtn.addEventListener("click",(t=>this._onReset(t))),this._scroller.addEventListener("mousedown",(t=>{t.target.closest("input[type=range]")||t.preventDefault()}))}))}_onMouseWheel(t){t.deltaMode||(t.preventDefault(),t.currentTarget.scrollTop+=t.deltaY)}_onChange(t){clearTimeout(this._throttleTimeout),"range"==t.target.type?this._throttleTimeout=setTimeout((()=>this.emitter.emit("change")),150):this.emitter.emit("change")}_onReset(){this._resetRipple.animate();const t=this.getSettings();for(const t of this._globalInputs)"checkbox"==t.type?t.checked=t.hasAttribute("checked"):"range"==t.type&&(this._sliderMap.get(t).value=t.getAttribute("value"));for(const t of this._pluginInputs)t.checked=t.hasAttribute("checked");this.emitter.emit("reset",t),this.emitter.emit("change")}setSettings(t){for(const e of this._globalInputs)e.name in t&&("checkbox"==e.type?e.checked=t[e.name]:"range"==e.type&&(this._sliderMap.get(e).value=t[e.name]));for(const e of this._pluginInputs)e.name in t.plugins&&(e.checked=t.plugins[e.name])}getSettings(){const t=[],e={plugins:{}};return this._globalInputs.forEach((s=>{"gzip"!=s.name&&"original"!=s.name&&("checkbox"==s.type?t.push(Number(s.checked)):t.push("|"+s.value+"|")),"checkbox"==s.type?e[s.name]=s.checked:e[s.name]=s.value})),this._pluginInputs.forEach((s=>{t.push(Number(s.checked)),e.plugins[s.name]=s.checked})),e.fingerprint=t.join(),e}}class I{constructor(){this.emitter=D(),this.allowHide=!1,this._spinner=new E,t.then((()=>{this.container=document.querySelector(".main-menu"),this._loadFileInput=document.querySelector(".load-file-input"),this._pasteInput=document.querySelector(".paste-input"),this._loadDemoBtn=document.querySelector(".load-demo"),this._loadFileBtn=document.querySelector(".load-file"),this._pasteLabel=document.querySelector(".menu-input"),this._overlay=this.container.querySelector(".overlay"),this._menu=this.container.querySelector(".menu"),document.querySelector(".menu-btn").addEventListener("click",(t=>this._onMenuButtonClick(t))),this._overlay.addEventListener("click",(t=>this._onOverlayClick(t))),this._loadFileBtn.addEventListener("click",(t=>this._onLoadFileClick(t))),this._loadDemoBtn.addEventListener("click",(t=>this._onLoadDemoClick(t))),this._loadFileInput.addEventListener("change",(()=>this._onFileInputChange())),this._pasteInput.addEventListener("input",(()=>this._onTextInputChange()))}))}show(){this.container.classList.remove("hidden"),c(this._overlay,"hidden"),c(this._menu,"hidden")}hide(){this.allowHide&&(this.stopSpinner(),this.container.classList.add("hidden"),a(this._overlay,"hidden"),a(this._menu,"hidden"))}stopSpinner(){this._spinner.hide()}showFilePicker(){this._loadFileInput.click()}setPasteInput(t){this._pasteInput.value=t,this._pasteInput.dispatchEvent(new Event("input"))}_onOverlayClick(t){t.preventDefault(),this.hide()}_onMenuButtonClick(t){t.preventDefault(),this.show()}_onTextInputChange(){const t=this._pasteInput.value.trim();t.includes("</svg>")&&(this._pasteInput.value="",this._pasteInput.blur(),this._pasteLabel.appendChild(this._spinner.container),this._spinner.show(),this.emitter.emit("svgDataLoad",{data:t,filename:"image.svg"}))}_onLoadFileClick(t){t.preventDefault(),t.target.blur(),this.showFilePicker()}async _onFileInputChange(){const t=this._loadFileInput.files[0];t&&(this._loadFileBtn.appendChild(this._spinner.container),this._spinner.show(),this.emitter.emit("svgDataLoad",{data:await o(t),filename:t.name}))}async _onLoadDemoClick(t){t.preventDefault(),t.target.blur(),this._loadDemoBtn.appendChild(this._spinner.container),this._spinner.show();try{this.emitter.emit("svgDataLoad",{data:await fetch("test-svgs/car-lite.svg").then((t=>t.text())),filename:"car-lite.svg"})}catch(t){this.stopSpinner();const e="serviceWorker"in navigator&&navigator.serviceWorker.controller?Error("Demo not available offline"):Error("Couldn't fetch demo SVG");this.emitter.emit("error",{error:e})}}}class T{constructor(t,e,i){this.container=s('<div class="toast"><div class="toast-content"></div></div>'),this._content=this.container.querySelector(".toast-content"),this._content.textContent=t,this._answerResolve,this._hideTimeout,this.answer=new Promise((t=>this._answerResolve=t)),i.forEach((t=>{var e=document.createElement("button");e.className="unbutton",e.textContent=t,e.addEventListener("click",(()=>{this._answerResolve(t)})),this.container.appendChild(e)})),e&&(this._hideTimeout=setTimeout((()=>this.hide()),e))}hide(){return clearTimeout(this._hideTimeout),this._answerResolve(),a(this.container,"hide")}}class R{constructor(){this.container=s("<div class='toasts'></div>")}show(t,{duration:e=0,buttons:s=["dismiss"]}={}){const i=new T(t,e,s);return this.container.appendChild(i.container),i.answer.then((()=>i.hide())).then((()=>{this.container.removeChild(i.container)})),i}}class z{constructor(){this.emitter=D(),this.container=s('<div class="drop-overlay">Drop it!</div>'),this._activeEnters=0,this._currentEnteredElement=null,t.then((()=>{document.addEventListener("dragover",(t=>t.preventDefault())),document.addEventListener("dragenter",(t=>this._onDragEnter(t))),document.addEventListener("dragleave",(()=>this._onDragLeave())),document.addEventListener("drop",(t=>this._onDrop(t)))}))}_onDragEnter(t){this._currentEnteredElement!=t.target&&(this._currentEnteredElement=t.target,this._activeEnters++||a(this.container))}_onDragLeave(){this._currentEnteredElement=null,--this._activeEnters||c(this.container)}async _onDrop(t){t.preventDefault(),this._activeEnters=0,c(this.container);const e=t.dataTransfer.files[0];e&&this.emitter.emit("svgDataLoad",{data:await o(e),filename:e.name})}}class B{constructor(){t.then((()=>{this.container=document.querySelector(".preloader"),this.activated=this.container.classList.contains("active"),this.hide()}))}async hide(){await c(this.container,"active"),this.container.style.display="none"}}class A{constructor(t){this.container=s('<section class="changelog"></section>'),this._loadedVersion=t}async showLogFrom(e){if(e==this._loadedVersion)return;const i=await fetch("changelog.json").then((t=>t.json()));let o=0,r=0;for(var c=0;c<i.length;c++){const t=i[c];if(t.version===this._loadedVersion)o=c;else if(t.version===e)break;r=c+1}const h=i.slice(o,r).reduce(((t,e)=>t.concat(e.changes)),[]).map((t=>n`<li>${t}</li>`));this.container.appendChild(s("<h1>Updated!</h1>")),this.container.appendChild(s("<ul>"+h.join("")+"</ul>")),await t,a(this.container)}}class j{constructor(e){this._results=e,t.then((()=>{this._mobileContainer=document.querySelector(".results-container-mobile"),this._container=document.querySelector(".results-container"),this._query=matchMedia("(min-width: 640px)"),this._query.addListener((()=>this._positionResults())),this._positionResults()}))}_positionResults(){this._query.matches?this._container.appendChild(this._results.container):this._mobileContainer.appendChild(this._results.container)}}class O{constructor(){this.emitter=D(),this.container=null,t.then((()=>{this.container=document.querySelector(".view-toggler"),this.container.output[0].checked=!0,this.container.addEventListener("change",(()=>this._onChange()))}))}_onChange(){this.emitter.emit("change",{value:this.container.output.value})}}class W{constructor(t){this._size=t,this.purge()}purge(){this._fingerprints=[],this._items=[],this._index=0}add(t,e){const s=this._items[this._index];s&&s.release(),this._fingerprints[this._index]=t,this._items[this._index]=e,this._index=(this._index+1)%this._size}match(t){return this._items[this._fingerprints.indexOf(t)]}}class H{constructor(...t){this._activated=!1,this._toActivate=t}activate(){if(!this._activated)return this._activated=!0,Promise.all(this._toActivate.map((t=>a(t))))}}const V=new class extends l{constructor(){super("js/svgo-worker.js"),this._currentJob=Promise.resolve()}async wrapOriginal(t){const{width:e,height:s}=await this._requestResponse({action:"wrapOriginal",data:t});return new u(t,e,s)}process(t,e){return this.abort(),this._currentJob=this._currentJob.catch((()=>{})).then((async()=>{const s=await this._requestResponse({action:"process",settings:e,data:t});return new u(s.data,s.dimensions.width,s.dimensions.height)}))}};var N;N="mouse",document.body.addEventListener("focus",(t=>{t.target.classList.add("key"==N?"key-focused":"mouse-focused")}),!0),document.body.addEventListener("blur",(t=>{t.target.classList.remove("key-focused","mouse-focused")}),!0),document.body.addEventListener("keydown",(()=>{N="key"}),!0),document.body.addEventListener("mousedown",(()=>{N="mouse"}),!0),new class{constructor(){this._container=null,this._mainUi=null,this._outputUi=new L,this._downloadButtonUi=new b,this._copyButtonUi=new S,this._bgFillUi=new x,this._resultsUi=new F,this._settingsUi=new q,this._mainMenuUi=new I,this._toastsUi=new R,this._dropUi=new z,this._preloaderUi=new B,this._changelogUi=new A(self.version),this._resultsContainerUi=new j(this._resultsUi),this._viewTogglerUi=new O,this._settingsUi.emitter.on("change",(()=>this._onSettingsChange())),this._settingsUi.emitter.on("reset",(t=>this._onSettingsReset(t))),this._mainMenuUi.emitter.on("svgDataLoad",(t=>this._onInputChange(t))),this._dropUi.emitter.on("svgDataLoad",(t=>this._onInputChange(t))),this._mainMenuUi.emitter.on("error",(({error:t})=>this._handleError(t))),this._viewTogglerUi.emitter.on("change",(t=>this._onViewSelectionChange(t))),window.addEventListener("keydown",(t=>this._onGlobalKeyDown(t))),window.addEventListener("paste",(t=>this._onGlobalPaste(t))),window.addEventListener("copy",(t=>this._onGlobalCopy(t))),this._inputItem=null,this._cache=new W(10),this._latestCompressJobId=0,this._userHasInteracted=!1,this._reloading=!1,"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js",{scope:"./"}).then((t=>{t.addEventListener("updatefound",(()=>this._onUpdateFound(t)))})),h.get("last-seen-version").then((t=>{t&&this._changelogUi.showLogFrom(t),h.set("last-seen-version",self.version)})),t.then((()=>{this._container=document.querySelector(".app-output"),this._mainUi=new H(document.querySelector(".toolbar"),document.querySelector(".action-button-container"),this._outputUi.container,this._settingsUi.container);const t=document.querySelector(".action-button-container"),e=document.querySelector(".minor-action-container");e.appendChild(this._bgFillUi.container),e.appendChild(this._copyButtonUi.container),t.appendChild(this._downloadButtonUi.container),document.querySelector(".output").appendChild(this._outputUi.container),this._container.appendChild(this._toastsUi.container),this._container.appendChild(this._dropUi.container),document.querySelector(".menu-extra").appendChild(this._changelogUi.container),this._loadSettings(),this._preloaderUi.activated&&this._toastsUi.show("Ready now!",{duration:3e3})}))}_onGlobalKeyDown(t){"o"===t.key&&(t.ctrlKey||t.metaKey)&&(t.preventDefault(),this._mainMenuUi.showFilePicker()),"Escape"===t.key&&this._mainMenuUi.hide()}_onGlobalPaste(t){const e=t.clipboardData.getData("text").trim();e.includes("</svg>")?(this._mainMenuUi.setPasteInput(e),t.preventDefault()):this._toastsUi.show("Pasted value not an SVG",{duration:2e3})}_onGlobalCopy(t){window.getSelection().isCollapsed&&(this._copyButtonUi.copyText()?this._toastsUi.show("Copy successful",{duration:2e3}):this._toastsUi.show("Nothing to copy",{duration:2e3}),t.preventDefault())}_onViewSelectionChange(t){this._outputUi.set(t.value)}_onUpdateFound(t){const e=t.installing;t.installing.addEventListener("statechange",(async()=>{if(!this._reloading)if("activated"!=e.state||navigator.serviceWorker.controller){if("activated"==e.state&&navigator.serviceWorker.controller){if(!this._userHasInteracted)return this._reloading=!0,void location.reload();const t=this._toastsUi.show("Update available",{buttons:["reload","dismiss"]});"reload"==await t.answer&&(this._reloading=!0,location.reload())}}else this._toastsUi.show("Ready to work offline",{duration:5e3})}))}_onSettingsChange(){const t=this._settingsUi.getSettings();this._saveSettings(t),this._compressSvg(t)}async _onSettingsReset(t){const e=this._toastsUi.show("Settings reset",{buttons:["undo","dismiss"],duration:5e3});"undo"===await e.answer&&(this._settingsUi.setSettings(t),this._onSettingsChange())}async _onInputChange(t){const e=this._settingsUi.getSettings();this._userHasInteracted=!0;try{this._inputItem=await V.wrapOriginal(t.data),this._inputFilename=t.filename}catch(t){const e=new Error("Load failed: "+t.message);return this._mainMenuUi.stopSpinner(),void this._handleError(e)}this._cache.purge(),this._compressSvg(e),this._outputUi.reset(),this._mainUi.activate(),this._mainMenuUi.allowHide=!0,this._mainMenuUi.hide()}_handleError(t){this._toastsUi.show(t.message),console.error(t)}async _loadSettings(){const t=await h.get("settings");t&&this._settingsUi.setSettings(t)}_saveSettings(t){const e=Object.assign({},t);delete e.original,h.set("settings",e)}async _compressSvg(t){const e=this._latestCompressJobId=Math.random();if(await V.abort(),e!=this._latestCompressJobId)return;if(t.original)return void this._updateForFile(this._inputItem,{compress:t.gzip});const s=this._cache.match(t.fingerprint);if(s)this._updateForFile(s,{compareToFile:this._inputItem,compress:t.gzip});else{this._downloadButtonUi.working();try{const e=await V.process(this._inputItem.text,t);this._updateForFile(e,{compareToFile:this._inputItem,compress:t.gzip}),this._cache.add(t.fingerprint,e)}catch(t){if("AbortError"===t.name)return;t.message="Minifying error: "+t.message,this._handleError(t)}finally{this._downloadButtonUi.done()}}}async _updateForFile(t,{compareToFile:e,compress:s}){this._outputUi.update(t),this._downloadButtonUi.setDownload(this._inputFilename,t),this._copyButtonUi.setCopyText(t.text),this._resultsUi.update({comparisonSize:e&&await e.size({compress:s}),size:await t.size({compress:s})})}}}();
//# sourceMappingURL=page.js.map
